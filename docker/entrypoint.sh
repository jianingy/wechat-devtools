#!/bin/bash

#
# 入口文件
#

export NO_AT_BRIDGE=1

# docker下的开发工具初始启动(目录 `~/.config/微信web开发者工具`为空)时会失败，但如果初始化后就没问题了
init_config() {
    config_dir="$HOME/.config/微信web开发者工具"
    if [ ! -d "$config_dir" ]; then
        mkdir -p "$config_dir"/Default
        cat > "$config_dir"/Default/Preferences << "EOF"
{"account_id_migration_state":2,"account_tracker_service_last_update":"13191223769143271","browser":{"has_seen_welcome_page":false},"countryid_at_install":-1,"data_reduction":{"daily_original_length":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","92346"],"daily_original_length_application":"0","daily_original_length_unknown":"0","daily_original_length_via_data_reduction_proxy":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"daily_original_length_via_data_reduction_proxy_application":"0","daily_original_length_via_data_reduction_proxy_unknown":"0","daily_original_length_via_data_reduction_proxy_video":"0","daily_original_length_video":"0","daily_original_length_with_data_reduction_proxy_enabled":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"daily_original_length_with_data_reduction_proxy_enabled_application":"0","daily_original_length_with_data_reduction_proxy_enabled_unknown":"0","daily_original_length_with_data_reduction_proxy_enabled_video":"0","daily_received_length":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","92346"],"daily_received_length_application":"0","daily_received_length_https_with_data_reduction_proxy_enabled":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"daily_received_length_long_bypass_with_data_reduction_proxy_enabled":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"daily_received_length_short_bypass_with_data_reduction_proxy_enabled":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"daily_received_length_unknown":"0","daily_received_length_unknown_with_data_reduction_proxy_enabled":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"daily_received_length_via_data_reduction_proxy":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"daily_received_length_via_data_reduction_proxy_application":"0","daily_received_length_via_data_reduction_proxy_unknown":"0","daily_received_length_via_data_reduction_proxy_video":"0","daily_received_length_video":"0","daily_received_length_with_data_reduction_proxy_enabled":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"daily_received_length_with_data_reduction_proxy_enabled_application":"0","daily_received_length_with_data_reduction_proxy_enabled_unknown":"0","daily_received_length_with_data_reduction_proxy_enabled_video":"0","last_update_date":"13191177600000000"},"data_reduction_lo_fi":{"load_images_requests_per_session":0,"load_images_snackbars_shown_per_session":0,"was_used_this_session":false},"extensions":{"alerts":{"initialized":true},"chrome_url_overrides":{},"last_chrome_version":"62.0.3202.62","settings":{"ikhdnebglabgeplgnhnjgldiemdflddf":{"active_permissions":{"api":["developerPrivate","management"],"explicit_host":["\u003Call_urls>","chrome://favicon/*"],"manifest_permissions":[]},"app_launcher_ordinal":"n","commands":{},"content_settings":[],"creation_flags":38,"events":["nw.App.onOpen","nw.App.onReopen","nw.Screen.onDisplayAdded","nw.Screen.onDisplayBoundsChanged","nw.Screen.onDisplayRemoved","nw.Screen.onSourceAdded","nw.Screen.onSourceNameChanged","nw.Screen.onSourceOrderChanged","nw.Screen.onSourceRemoved","nw.Screen.onSourceThumbnailChanged"],"from_bookmark":false,"from_webstore":false,"geometry_cache":{"init":{"h":474,"screen_bounds_h":1080,"screen_bounds_w":1920,"screen_bounds_x":0,"screen_bounds_y":0,"state":1,"ts":"13191223769286941","w":334,"x":793,"y":315}},"granted_permissions":{"api":["developerPrivate","management"],"explicit_host":["\u003Call_urls>","chrome://favicon/*"],"manifest_permissions":[]},"has_declarative_rules":{"declarativeContent":{"onPageChanged":false},"declarativeWebRequest":{"onRequest":false}},"incognito_content_settings":[],"incognito_preferences":{},"install_time":"13191224194835525","is_active":true,"last_launch_time":"13191224194973898","location":8,"never_activated_since_loaded":true,"newAllowFileAccess":true,"page_ordinal":"n","path":"/home/sigoden/w/docker-wxtools/dist/package.nw","preferences":{"proxy":{"mode":"pac_script","pac_mandatory":false,"pac_url":"data:application/x-ns-proxy-autoconfig;base64,ZnVuY3Rpb24gRmluZFByb3h5Rm9yVVJMKHVybCwgaG9zdCkgewogICAgICAgICAgICAgIGlmICgvXmh0dHBzP1w6XC9cLy4qP1wuZGVidWcub3Blbi53ZWl4aW4ucXEuY29tLy50ZXN0KHVybCl8fC9eaHR0cHM/XDpcL1wvLio/XC5hcHBzZXJ2aWNlLm9wZW4ud2VpeGluLnFxLmNvbS8udGVzdCh1cmwpfHwvXmh0dHBzP1w6XC9cL3d4ZmlsZS5vcGVuLndlaXhpbi5xcS5jb21cLy8udGVzdCh1cmwpfHx1cmwuaW5kZXhPZignaHR0cDovL2Fib3V0YmxhbmsnKSA9PT0gMHx8dXJsLmluZGV4T2YoJ2h0dHBzOi8vY2xpZW50czEuZ29vZ2xlLmNvbS90YnByb3h5L2FmLycpID09PSAwfHwvXmh0dHBzP1w6XC9cLy4qP1wuP2VkaXRvcnNlcnZpY2Uub3Blbi53ZWl4aW4ucXEuY29tLy50ZXN0KHVybCl8fC9eaHR0cHM/XDpcL1wvLio/XC4/cGx1Z2luc2VydmljZS5vcGVuLndlaXhpbi5xcS5jb20vLnRlc3QodXJsKXx8L15odHRwcz9cOlwvXC8uKj9cLndpZGdldC5vcGVuLndlaXhpbi5xcS5jb20vLnRlc3QodXJsKXx8L15odHRwcz9cOlwvXC8uKj9cLndpZGdldHNlcnZpY2Uub3Blbi53ZWl4aW4ucXEuY29tLy50ZXN0KHVybCl8fC9eaHR0cHM/XDpcL1wvLio/XC5nYW1lLm9wZW4ud2VpeGluLnFxLmNvbS8udGVzdCh1cmwpfHwvXmh0dHBzP1w6XC9cL3RyYWNlLm9wZW4ud2VpeGluLnFxLmNvbS8udGVzdCh1cmwpfHwvXmh0dHA6XC9cL3VzclwvLy50ZXN0KHVybCl8fC9eaHR0cDpcL1wvb3BlbmRhdGEvLnRlc3QodXJsKXx8L15odHRwOlwvXC9zdG9yZVwvLy50ZXN0KHVybCl8fC9eaHR0cDpcL1wvdG1wXC8vLnRlc3QodXJsKSkgewogICAgcmV0dXJuICdQUk9YWSAxMjcuMC4wLjE6MzcwNjYnCiAgfQoKICBpZiAoL14oaHR0cHx3cylzP1w6XC9cLyhsb2NhbGhvc3R8MTI3LjAuMC4xKS8udGVzdCh1cmwpKXsKICAgIHJldHVybiAnRElSRUNUJwogIH0KICAgICAgICAgICAgICByZXR1cm4gJ0RJUkVDVCcKICAgICAgICAgICAgfQ=="}},"regular_only_preferences":{},"running":true,"state":1,"was_installed_by_default":false,"was_installed_by_oem":false},"lheejlmfljoldkikifmjdfnjbjhpadcm":{"active_permissions":{"api":["devtools"],"manifest_permissions":[]},"commands":{},"content_settings":[],"creation_flags":38,"events":[],"from_bookmark":false,"from_webstore":false,"granted_permissions":{"api":["devtools"],"manifest_permissions":[]},"incognito_content_settings":[],"incognito_preferences":{},"initial_keybindings_set":true,"install_time":"13191224194834716","location":8,"never_activated_since_loaded":true,"newAllowFileAccess":true,"path":"/home/sigoden/w/docker-wxtools/dist/package.nw/js/ideplugin","preferences":{},"regular_only_preferences":{},"state":1,"was_installed_by_default":false,"was_installed_by_oem":false},"mhjfbmdgcfjbbpaeojofohoefgiehjai":{"active_permissions":{"api":["resourcesPrivate"],"explicit_host":["\u003Call_urls>","chrome://favicon/*"],"manifest_permissions":[]},"commands":{},"content_settings":[],"creation_flags":1,"events":[],"from_bookmark":false,"from_webstore":false,"incognito_content_settings":[],"incognito_preferences":{},"initial_keybindings_set":true,"install_time":"13191223769141777","location":5,"manifest":{"content_security_policy":"script-src 'self' blob: filesystem: chrome://resources; object-src * blob: externalfile: file: filesystem: data:; plugin-types application/x-google-chrome-pdf","description":"","incognito":"split","key":"MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDN6hM0rsDYGbzQPQfOygqlRtQgKUXMfnSjhIBL7LnReAVBEd7ZmKtyN2qmSasMl4HZpMhVe2rPWVVwBDl6iyNE/Kok6E6v6V3vCLGsOpQAuuNVye/3QxzIldzG/jQAdWZiyXReRVapOhZtLjGfywCvlWq7Sl/e3sbc0vWybSDI2QIDAQAB","manifest_version":2,"mime_types":["application/pdf"],"mime_types_handler":"index.html","name":"Chromium PDF Viewer","offline_enabled":true,"permissions":["\u003Call_urls>","resourcesPrivate"],"version":"1","web_accessible_resources":["*.js","*.html","*.css","*.png"]},"never_activated_since_loaded":true,"path":"/app/resources/pdf","preferences":{},"regular_only_preferences":{},"state":1,"was_installed_by_default":false,"was_installed_by_oem":false},"opodgneinibmbjdmghbfclhadicpjdni":{"active_permissions":{"api":["devtools"],"manifest_permissions":[]},"commands":{},"content_settings":[],"creation_flags":38,"events":[],"from_bookmark":false,"from_webstore":false,"granted_permissions":{"api":["devtools"],"manifest_permissions":[]},"incognito_content_settings":[],"incognito_preferences":{},"initial_keybindings_set":true,"install_time":"13191223769149128","location":8,"never_activated_since_loaded":true,"newAllowFileAccess":true,"path":"/app/package.nw/js/ideplugin","preferences":{},"regular_only_preferences":{},"state":1,"was_installed_by_default":false,"was_installed_by_oem":false}},"theme":{"use_system":true}},"gcm":{"product_category_for_subtypes":"com.nwjs.linux"},"http_original_content_length":"92346","http_received_content_length":"92346","invalidator":{"client_id":"/CvN6jsX4phQyNxM8dXEEg=="},"media":{"device_id_salt":"sRyAfEAYX/wxVwgqu5eIow=="},"ntp":{"num_personal_suggestions":2},"partition":{"per_host_zoom_levels":{"x":{}}},"plugins":{"plugins_list":[]},"profile":{"avatar_bubble_tutorial_shown":2,"avatar_index":26,"content_settings":{"domain_to_origin_migration_status":1,"exceptions":{"accessibility_events":{},"app_banner":{},"auto_select_certificate":{},"automatic_downloads":{},"autoplay":{},"background_sync":{},"bluetooth_guard":{},"client_hints":{},"cookies":{},"durable_storage":{},"geolocation":{},"images":{},"important_site_info":{},"javascript":{},"media_engagement":{},"media_stream_camera":{},"media_stream_mic":{},"midi_sysex":{},"mixed_script":{},"notifications":{},"password_protection":{},"permission_autoblocking_data":{},"plugins":{},"popups":{},"ppapi_broker":{},"prompt_no_decision_count":{},"protocol_handler":{},"sensors":{},"site_engagement":{},"sound":{},"ssl_cert_decisions":{},"subresource_filter":{},"subresource_filter_data":{},"usb_chooser_data":{}},"pref_version":1},"created_by_version":"62.0.3202.62","exit_type":"Normal","exited_cleanly":true,"local_profile_id":4297331,"managed_user_id":"","name":"Person 1"},"protection":{"macs":{"browser":{"show_home_button":"904452986128BBEE5A7B1FFB8F342100C3150E3D9FD76C4105DF33EB021E22FD"},"default_search_provider_data":{"template_url_data":"575D258E47F940C6887685ABA99A5839CBFE4BA30863349DFE0D0C375AAB8816"},"extensions":{"settings":{"ikhdnebglabgeplgnhnjgldiemdflddf":"46239BD686F188D59D7C1BE9A92C1574FA8AA9521AFEB373D8F266E34118DA42","lheejlmfljoldkikifmjdfnjbjhpadcm":"8FE516B96A88EE1E6F7F167862AC97526A63701919CA15DB3D8749D5CC3187C5","mhjfbmdgcfjbbpaeojofohoefgiehjai":"95DB00015A892A42D603B6123D88A9866A7AC77F7779FD8C8767A6BEAC7D3C0E","opodgneinibmbjdmghbfclhadicpjdni":"330C251D81442B372FF48AB87A1598C952515B2D7DB7D8370611BC9D8B9DD5EA"}},"google":{"services":{"account_id":"E5B4CD7C5FA271A47D07D462465AFD63DBF6A8CDFAFEF4839D13F8F552131486","last_account_id":"6C67156FD15665D53CD24B5098D16B462BA8B8A0EFDD969A317C3235E973A4A3","last_username":"24FCEF9BF7DF12A2935BE143E58951E09DBAA1D3E0E24430C0FF93009F5D6AFD","username":"D26BCA1B2F99EDF1D42826D14541328D9E374F4559553FC3BB7E76405AC31AE2"}},"homepage":"B1E9FE8108A84F532486D13AAC43C0AFDA16D3DFC9EB2F743AEE11F89F2F163E","homepage_is_newtabpage":"3680F776D17E3C099431BAF5381FAB9BCC0C2C70FEA4C74D12324BC94A207119","pinned_tabs":"5FF265371BB528ED630092A900058C08217611AB525D4C12B41C44C008BAC799","prefs":{"preference_reset_time":"95C909F3D0669D5931907B455F099C510E7770D9F0BA6FF13E4C76101B44F757"},"safebrowsing":{"incidents_sent":"569707D9A4676B72F48BE92B740BE3EF895419C8A646F1AE1BA70BD9C3B41845"},"search_provider_overrides":"1E1EBA3A4DC28A23BEFCF6ED5D71CE71E9814DD587A305F6B14F72E834AF75DD","session":{"restore_on_startup":"F9BD26F5D1AA6AB5258754888529CB2A82AE68D1703BCC2A97DEAEE5DDDA190E","startup_urls":"8BB8DBC1D7CA5C58F821C38254FB2B9C874F8EE9B9905B57DE48C731C6C91837"}}}}
EOF
    fi
}
init_config

init_wine() {
    if [ ! -d "$HOME/.wine" ]; then
        mkdir -p "$config_dir/wine"
        ln -s "$config_dir/wine" ~/.wine
    fi
}
init_wine

/app/launch.sh